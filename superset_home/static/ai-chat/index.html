<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI Assistant</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7/babel.min.js"></script>
  <style>
    body,html{margin:0;padding:0;height:100%;background:#1a1a1a;color:#fff;font-family:system-ui}
    .chat{max-width:420px;margin:0 auto;display:flex;flex-direction:column;height:100%}
    .header{padding:16px;background:#000;text-align:center;font-weight:bold}
    .messages{flex:1;overflow-y:auto;padding:16px}
    .msg{margin:12px 0;display:flex;flex-direction:column}
    .user{align-items:flex-end}
    .user .bubble{background:#007bff;color:white}
    .ai .bubble{background:#333}
    .bubble{max-width:85%;padding:12px 16px;border-radius:18px;word-wrap:break-word}
    .input-area{padding:16px;background:#1a1a1a;border-top:1px solid #333}
    textarea{width:100%;background:#2d2d2d;color:white;border:1px solid #444;border-radius:12px;padding:14px;font-size:15px;resize:none}
    button{margin-top:10px;width:100%;padding:14px;background:#007bff;border:none;border-radius:12px;color:white;font-size:16px;cursor:pointer}
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const {useState,useEffect,useRef}=React;
    function App(){
      const [messages,setMessages]=useState([{role:"ai",text:"Hey boss! Ask me anything about your patients..."}]);
      const [input,setInput]=useState("");
      const [loading,setLoading]=useState(false);
      const endRef=useRef(null);
      useEffect(()=>{endRef.current?.scrollIntoView({behavior:"smooth"})},[messages]);
      const send=async()=>{
        if(!input.trim()||loading)return;
        const q=input.trim();
        setMessages(m=>[...m,{role:"user",text:q}]);
        setInput("");setLoading(true);
        try{
          const res=await fetch("http://localhost:5000/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:q})});
          const data=await res.json();
          let answer=data.answer||"No answer";
          if(data.sql)answer+="\n\nSQL: "+data.sql;
          setMessages(m=>[...m,{role:"ai",text:answer}]);
        }catch(e){
          setMessages(m=>[...m,{role:"ai",text:"AI service offline"}]);
        }
        setLoading(false);
      };
      return (
        <div className="chat">
          <div className="header">Smart AI Assistant</div>
          <div className="messages">
            {messages.map((m,i)=><div key={i} className={`msg ${m.role}`}><div className="bubble">{m.text}</div></div>)}
            {loading&&<div className="msg ai"><div className="bubble">Thinking...</div></div>}
            <div ref={endRef}/>
          </div>
          <div className="input-area">
            <textarea rows={3} placeholder="Ask anything..." value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),send())}/>
            <button onClick={send}>Send</button>
          </div>
        </div>
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
